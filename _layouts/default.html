<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {%- include head.html -%}

  <body>

    {%- include header.html -%}

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

          <header class="post-header">
            <h1 class="post-title">{{ page.title | escape }}</h1>
          </header>

          <div class="post-content">
            {{ content }}
          </div>

        </article>
      </div>
    </main>

    <!-- Floating TOC -->
    <div id="toc-container">
      <div id="toc">
        <h4>Table of Contents</h4>
        <ul id="toc-list"></ul>
      </div>
    </div>

    {%- include footer.html -%}

    <script>
      // Generate TOC from headings
      document.addEventListener('DOMContentLoaded', function() {
        const tocList = document.getElementById('toc-list');
        const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
        const tocContainer = document.getElementById('toc-container');
        
        if (headings.length > 2) { // Show TOC only if there are more than 2 headings
          headings.forEach(function(heading, index) {
            // Skip the main title (first h1)
            if (index === 0 && heading.tagName === 'H1') return;
            
            const id = 'heading-' + index;
            heading.id = id;
            
            const li = document.createElement('li');
            li.className = 'toc-' + heading.tagName.toLowerCase();
            
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.addEventListener('click', function(e) {
              e.preventDefault();
              heading.scrollIntoView({ behavior: 'smooth' });
            });
            
            li.appendChild(a);
            tocList.appendChild(li);
          });
          
          // Show/hide TOC on scroll - always floating
          let ticking = false;
          function updateTOC() {
            const scrollTop = window.pageYOffset;
            tocContainer.style.display = scrollTop > 300 ? 'block' : 'none';
            ticking = false;
          }
          
          // Initial check
          updateTOC();
          
          window.addEventListener('scroll', function() {
            if (!ticking) {
              requestAnimationFrame(updateTOC);
              ticking = true;
            }
          });
        } else {
          tocContainer.style.display = 'none';
        }
      });
    </script>

  </body>

</html>